<!doctype html>
<html lang="en">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<style>
  .margin-bottom {
      margin-bottom: 15px ;
  }

  .nav{
    max-height: 30px;
    overflow-y: scroll;
}
</style>

<script src="fabric.js"></script>
<script src="util.js"></script>
<script src="node.js"></script>
<script src="tree.js"></script>
<script src="board.js"></script>
<script src="myTbox.js"></script>

    
<div class="jumbotron text-center ">
<h1>Learning Monte Carlo Tree Search Algorithm </h>
    <h2> 26th November 2018 </h2>
    <p> Started this project to enable application of this techncique 
in UAV applicaitons.  This is a test bed with the simple Tic Toc Toe game </p>
</div>

<div class="container">
  <div class="row">
   <div class="col-md-3">
      <h3>Parameters</h3>
         <label class="col-sm-8">No. of Expolorations:</label>
         <input class="col-sm-4 margin-bottom" type="number"  id="nexp">

         <label class="col-sm-8"> No. of Simulations:</label>
         <input class="col-sm-4 margin-bottom" type="number"  id="nsim">

         <label class="col-sm-8">Exploration Factor:</label>
         <input class="col-sm-4 margin-bottom" type="number"  id="utcf">

         <button id="simbtn" type="button" class=" btn btn-primary">simulate</button>
    </div>
   <div class="col-md-9 margin-bottom"  >
      <h3>Decision Tree</h3>
      <canvas id="canvas"> 
      </canvas>
   </div>
  </div>

  <div class=row>
      <h3>Status</h3>
    <div id="status" class=well rounded style="height:60px; overflow: scroll">
    </div>
  </div>
</div>
                   
<script>
/* Tic Tac Toe Cells
   Author: Ravi Sankar Saripalli
   Date: 26th November
   Version: 0.1
status("Are you awake");
   Last Modified  28th Nov.

 Change Log:
  28th Nov. Completed node class structure and node exploration function "addNode"
  29th Nov. Added method to board class to enable game evaluation (WIN/DRAW)
  03 Dec.   Totally revamped the code to enable state tracking of nodes with board class
            Got stuck with issue related to deep cloning of objects (the board object)
            Deep cloning of generic object is not trivial, but simple vectors or sets whose members
            are of simple type (eg. numbers, or strings) can be easily cloned.
            
            The MonteCarlo Tree Search in my own words
             
             Selection
            - Starting from root node, look for fully expanded node whose all possible children have
              been spawned and initialized. Choose the best of the children based on win/trials ratio
              With the best child continue the process until you hit unexpanded or partially expanded node.

            - Epansion 
               First spawn off a new child node from the previously found partiallly expanded node. 
               If it is not terminal node (node that can't have children).  
             
             - Simulation
               play a random game from the freshly spawned child state
               until game is drawn or over. (Note:) During this phase no new nodes are created but
               visited in a volatile space.

             - Propagation
               With the end result of the game at hand, propagate the information up the tree till we reach the root
               re-enforcing the desired behaviour.

         
         Repeat enough times until some convergence ...

         .... reward calculations are yet to be properly implemented
         ....  Expansion of tree heuristics yet to be understood   


*/


</script>

<script>
   
 var canvas = new fabric.Canvas("canvas", {backgroundColor: 'lightyellow',
                                              width: 800, height: 400});

  // var my = new myTbox ("Ravi Sankar", 150, 100);
  //my.group.top = 100 ;  my.group.left = 100 ;  my.flashtxt(true);

  var gcells = [] ;
  [0, 1, 2].forEach ( function(x) {
                         let b = new myTbox ("X", 100, 100) ;
                             b.group.top = 100;
                             b.group.left = x * (100 + 2) ;
                             gcells.push (b) ;
                             });
  [3, 4, 5].forEach ( function(x) {
                         let b = new myTbox ("X", 100, 100) ;
                             b.group.top = 200 + 2;
                             b.group.left = (x - 3) * (100 + 2) ;
                             gcells.push (b) ;
                             });
  [6, 7, 8].forEach ( function(x) {
                         let b = new myTbox ("X", 100, 100) ;
                             b.group.top = 300 + 4;
                             b.group.left = (x - 6) * (100 + 2) ;
                             gcells.push (b) ;
                             }); 
                            // console.log(gcells.size, gcells);

  var gboard = new fabric.Group(gcells[0], gcells[1], gcells[2],
                                gcells[3], gcells[4], gcells[5],
                                gcells[6], gcells[7], gcells[8] );                           
  gboard.top = 30 ;
  gboard.left = 30 ; console.log(gboard);
  canvas.add(gboard); canvas.renderAll();
</script>

<script>

    $(document).ready(function() {

      $("#nsim").val(100) ;
      $("#nexp").val(100) ;
      $("#utcf").val(0.2) ;

    }); // end of Initial Set up


$("#simbtn").click(function() {
   
  status ("Started Tree Search") ;
   var game = new tree(); game.UTCF =  $("#utcf").val() ;

   console.log("Root Node: \n", game.root);
  
  for (let i=0 ; i < $("#nexp").val() ; i++) {  
     game.select() ;  
     for(let j=0 ; j < $("#nsim").val() ; j++) {   
        game.simulate() ;   
        game.propagate() ;   
  }};

  status ("Final Best Path") ;
  game.bestPath() ;
  
}); // Simulation button click 

// Script that provides the user interface
function status(msg) { // Add messages to status
    // an easier way is to use innerHTML but that is not safe!!!
    var br = document.createElement("br") ;
    // var d = new Date();    var n = d.toLocaleString();
    var content = document.createTextNode(msg) ; 
    $("#status").append(br, content) ;
}
</script>

</html>

